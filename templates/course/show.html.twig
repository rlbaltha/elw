{% extends 'base.html.twig' %}

{% block title %}Course Home - {{ parent() }}{% endblock %}

{% block subnav %}
    {% if status !='Pending' %}
        {{ include('course/_subnav.html.twig') }}
    {% endif %}
{% endblock %}

{% block subnavright %}
    <li class="nav-item">
        <a data-toggle="modal" data-target="#helpModal" href="javascript:void(0);" class="nav-link">Course Help</a>
    </li>
{% endblock %}

{% block toolnav %}
    {{ include('course/_coursenav.html.twig') }}
{% endblock %}



{% block body %}
    <div class="row">
        <div class="col">
            <div class="jumbotron">
                <h2 class="">Hello, {{ user.firstname }}!</h2>
                {{ course.announcement|raw }}
                {% if role=='Instructor' %}
                <a class="btn btn-primary btn-sm float-right"
                   href="{{ course_path('course_announcement', {'courseid': course.id}) }}">Edit
                    Announcement</a>
                {% endif %}
            </div>
        </div>
    </div>

    {% if role=='Instructor' %}
        <div class="row">
            <div class="col">
                <h2 class="d-inline">Projects</h2>
                <a aria-label="Add project to {{ course.name }}" class="btn btn-primary btn-sm float-right"
                   href="{{ path('project_new', {'courseid': course.id}) }}">Add
                    Project</a>
                {% if course.projects %}
                    <table class="table table-bordered mt-3">
                        <thead class="thead-light">
                        <tr>
                            <th>Name</th>
                            <th>Stages</th>
                            <th>Rubric</th>
                            <th>Markup Sets</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for project in course.projects %}
                            <tr>
                                <td>
                                    <a aria-label="Edit Project {{ project.name }}" class="btn btn-secondary btn-sm"
                                       style="background:{{ project.color }}"
                                       href="{% if (is_granted('ROLE_ADMIN')) or (labelset.user == app.user) %}{{ path('project_edit', {'id': project.id}) }}{% else %}#{% endif %}">
                                        {{ project.name }}</a>
                                </td>
                                <td>
                                    {% if project.stages %}{% for stage in project.stages %}
                                        <button class="btn btn-secondary btn-sm"
                                                style="background:{{ stage.color }}">{{ stage.name }}</button> {% endfor %}{% endif %}
                                </td>
                                <td>
                                    {% if project.rubrics %}{% for rubric in project.rubrics %}{{ rubric.name }}{% if not loop.last %}, {% endif %}{% endfor %}{% endif %}
                                </td>
                                <td>
                                    {% if project.markupsets %}{% for markupset in project.markupsets %}{{ markupset.name }}{% if not loop.last %}, {% endif %} {% endfor %}{% endif %}
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="1">No Records Found</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col">
                <h2 class="d-inline">Gradebook Columns</h2>
                <a class="btn btn-primary btn-sm float-right"
                   href="{{ path('ags_new', {'courseid': course.id}) }}">Create Gradebook
                    Column</a>

                <table class="table table-bordered mt-3">
                    <thead class="thead-light">
                    <tr>
                        <th scope="col">Label</th>
                        <th scope="col">Max Score</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for lineitem in course.ltiAgs %}
                        <tr>
                            <td>{{ lineitem.label }}</td>
                            <td>{{ lineitem.max }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <h2 class="d-inline">Classlist</h2>
                <a class="btn btn-primary btn-sm float-right nrps"
                   href="#" data-request="{{ path('lti_nrps', {'courseid': course.id}) }}">Compare to eLC
                    Classlist</a>
                <table id="classlist" class="table table-bordered mt-3">
                    <thead class="thead-light">
                    <tr>
                        <th>Students</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                    <thead>
                    <tbody>
                    {% for classlist in classlists %}
                        <tr>
                            <td>{{ classlist.user.lastname }}, {{ classlist.user.firstname }} </td>
                            <td>{{ classlist.role }}</td>
                            <td>
                                <a class="btn btn-primary btn-sm"
                                   href="{{ path('classlist_edit', {'id': classlist.id}) }}">Edit</a>
                                {{ include('classlist/_delete_form.html.twig') }}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="col" id="nrps"></div>
            </div>
        </div>
    {% endif %}

    <!-- Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="helpModalLabel">Course Help</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><strong>Projects</strong> </p>

                    <p><strong>Gradebook</strong>  </p>

                    <p><strong>Classlist</strong>  </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            {# Delete course trigger #}
            $('#delete-trigger').click(function () {
                $("#delete-form").submit();
            });
            $(".nrps").click(function () {
                var request = $(this).attr('data-request')
                var target = '#nrps'
                $.ajax({
                    url: request, success: function (result) {
                        $(target).html(result);
                    }
                });
                $(this).hide();
            });
        });
    </script>
{% endblock %}